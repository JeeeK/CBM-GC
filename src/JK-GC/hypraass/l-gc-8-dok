  HYPRA-ASS  ASSEMBLERLISTING:               1    -.LI 3,8,3,"L-GC-8-DOK,W,P"  ; *************************  ; *  GARBAGE  COLLECTION  *  ; *   VON JOHANN KLASEK   *  ; * 1985-12-27 VERS. 1.1  *  ; *************************  ;  ; AUFRUF: SYS ...  ; RAEUMT STRINGSPEICHER AUF  ;  ; ES WERDEN NUR JENE SPEICHERSTELLEN  ; BENUETZT, DIE AUCH DIE NORMALE  ; GC VERWENDET; ALLE ANDEREN  ; WERDEN WIEDER RESTAURIERT.  ;               100  -.EQ STRPTR = $33  ; STRINGPOINTER               110  -.EQ BUFPTR = $5F  ; BUFFERPOINTER               120  -.EQ STRADR = $58  ; STRINGADRESSE               130  -.EQ STRDP  = $22  ; STRINGDESCRIPTORADRESSE               140  -.EQ MEMBEG = $31  ; SPEICHER-ANFANG               150  -.EQ MEMEND = $37  ; SPEICHER-ENDE               160  -.EQ BERANF = $FB  ; BEREICHSANFANG U. -ENDE               170  -.EQ BEREND = $FD               180  -.EQ FLAG   = $53  ; ENDE-FLAG               190  -.EQ LEN    = $4E  ; STRINGLAENGE               200  -.EQ STAT   = $4F  ; STRING-TYPE               210  -.EQ PTR    = $50  ; ARRAY-POINTER               990  -.BA $C500  C500 78     :1000 -          SEI            ; BETRIEBSSYS.-ROM  C501 A501   :1010 -          LDA 1          ; WEGBLENDEN  C503 48     :1020 -          PHA            ; DAMIT RAM ZUGAENGLICH  C504 A935   :1030 -          LDA #$35       ; WIRD  C506 8501   :1040 -          STA 1  C508 A537   :1050 -          LDA MEMEND     ; STRINGPOINTER  C50A 8533   :1060 -          STA STRPTR     ; UND BEREICHANFANG  C50C A638   :1070 -          LDX MEMEND+1   ; AUF SPEICHERENDE  C50E 8634   :1080 -          STX STRPTR+1   ; SETZEN  C510 85FB   :1090 -          STA BERANF  C512 86FC   :1100 -          STX BERANF+1  C514 A550   :1101 -          LDA PTR        ; PTR-REGISTER RETTEN  C516 A651   :1102 -          LDX PTR+1  C518 8DDCC6 :1103 -          STA SPTR  C51B 8EDDC6 :1104 -          STX SPTR+1  C51E A003   :1105 -          LDY #3  C520 B9FB00 :1106 -L10       LDA $FB,Y      ; ZERO-PAGE-REG.  C523 99DEC6 :1107 -          STA SPTR+2,Y   ; RETTEN  C526 88     :1108 -          DEY   C527 10F7   :1109 -          BPL L10  C529 C8     :1110 -          INY   C52A 8453   :1120 -          STY FLAG       ; FLAG=0  C52C A6FB   :1130 -BEGIN1    LDX BERANF     ; *** HAUPTSCHLEIFE ***  C52E A5FC   :1140 -          LDA BERANF+1   ; BEREICH  C530 86FD   :1150 -          STX BEREND     ; GENAU UM 8K  C532 85FE   :1160 -          STA BEREND+1   ; NACH UNTEN VERLEGEN  C534 38     :1170 -          SEC   C535 E920   :1180 -          SBC #$20  C537 9008   :1185 -          BCC L2  C539 85FC   :1190 -          STA BERANF+1  C53B E431   :1200 -          CPX MEMBEG     ; SPEICHERANFANG  C53D E532   :1210 -          SBC MEMBEG+1   ; ERREICHT?  C53F B012   :1220 -          BCS L1  C541 E653   :1230 -L2        INC FLAG       ; JA, ENDEFLAG SETZEN  C543 A531   :1240 -          LDA MEMBEG     ; BEREICHANFANG =  C545 A632   :1250 -          LDX MEMBEG+1   ; SPEICHERANFANG  C547 85FB   :1260 -          STA BERANF     ; BEREICHANFANG = BE-  C549 86FC   :1270 -          STX BERANF+1   ; REICHENDE (SONDERFALL)  C54B C5FD   :1271 -          CMP BEREND     ; => BEREICH IST 0 BYTE  C54D D004   :1272 -          BNE L1         ; LANG => FERTIG  C54F E4FE   :1273 -          CPX BEREND+1  C551 F074   :1274 -          BEQ ENDE  C553 A900   :1280 -L1        LDA #0         ; BUFFERPOINTER AUF  C555 855F   :1290 -          STA BUFPTR     ; $10000 OD. DEZ.  C557 8560   :1300 -          STA BUFPTR+1   ; 65536 SETZEN  C559 38     :1360 -          SEC            ; C=1: GETSA-SUBR INIT  C55A 20E1C5 :1370 -BEGIN2    JSR GETSA      ; STRING-ADRESSE HOLEN  C55D A54E   :1372 -          LDA LEN        ; STRINGLAENGE = 0 ?  C55F F03D   :1373 -          BEQ WEITER     ; KEINEN STRING MEHR  C561 98     :1380 -          TYA            ; GEFUNDEN  C562 E4FB   :1390 -          CPX BERANF  C564 E5FC   :1400 -          SBC BERANF+1  C566 9032   :1410 -          BCC L3         ; LIEGT STRINGADR.  C568 98     :1420 -          TYA            ; IM BEREICH ?  C569 E4FD   :1430 -          CPX BEREND  C56B E5FE   :1440 -          SBC BEREND+1  C56D B02B   :1450 -          BCS L3         ; NEIN, NAECHSTER STR.  C56F 38     :1460 -          SEC            ; JA, BUFFERPOINTER UM  C570 A55F   :1470 -          LDA BUFPTR     ; STRINGLAENGE  C572 E54E   :1480 -          SBC LEN        ; VERSCHIEBEN  C574 855F   :1490 -          STA BUFPTR  C576 B002   :1500 -          BCS L4  C578 C660   :1510 -          DEC BUFPTR+1  C57A 8459   :1512 -L4        STY STRADR+1   ; STRINGADR. ABSPEICHER  C57C 8658   :1513 -          STX STRADR  C57E A64E   :1520 -          LDX LEN        ; STRING IN DEN  C580 A000   :1530 -          LDY #0         ; BUFFERBEREICH  C582 B158   :1540 -LOOP1     LDA (STRADR),Y ; UEBERTRAGEN  C584 915F   :1550 -          STA (BUFPTR),Y  C586 C8     :1560 -          INY   C587 CA     :1570 -          DEX   C588 D0F8   :1580 -          BNE LOOP1  C58A 18     :1590 -          CLC   C58B A55F   :1600 -          LDA BUFPTR     ; NEUE STRINGADRESSE  C58D 6533   :1610 -          ADC STRPTR     ; BERECHNEN:  C58F 8558   :1620 -          STA STRADR     ; STRADR=BUFPTR-(65536-  C591 A560   :1630 -          LDA BUFPTR+1   ; STRPTR)  C593 6534   :1640 -          ADC STRPTR+1   ; DA 16-BIT BERECHNUNG  C595 8559   :1650 -          STA STRADR+1   ; => 65536 = 0 => SA=BP+SP  C597 20CAC6 :1660 -          JSR CORR       ; STRINGDESCRIPTOR  C59A 18     :1670 -L3        CLC            ; KORRIGIEREN  C59B 4C5AC5 :1680 -          JMP BEGIN2     ; NAECHSTEN STRING  C59E A55F   :1750 -WEITER    LDA BUFPTR     ; BUFFER LEER ?  C5A0 0560   :1760 -          ORA BUFPTR+1  C5A2 F01C   :1770 -          BEQ L6         ; JA, DANN BRAUCHT  C5A4 18     :1780 -          CLC            ; NICHTS VERSCHOBEN  C5A5 A533   :1790 -          LDA STRPTR     ; WERDEN  C5A7 AA     :1795 -          TAX   C5A8 655F   :1800 -          ADC BUFPTR     ; VERSCHIEBE PARAMETER  C5AA 8533   :1810 -          STA STRPTR     ; ERMITTELN  C5AC A534   :1820 -          LDA STRPTR+1  C5AE A8     :1825 -          TAY   C5AF 6560   :1830 -          ADC BUFPTR+1   ; BUFPTR=QUELLBLOCKANFANG  C5B1 8534   :1840 -          STA STRPTR+1  C5B3 A900   :1850 -          LDA #$00       ; QUELLBLOCKENDE+1  C5B5 855A   :1860 -          STA $5A        ; (=65536)  C5B7 855B   :1870 -          STA $5B  C5B9 8658   :1900 -          STX $58        ; ZIELBLOCKENDE+1  C5BB 8459   :1910 -          STY $59        ; BASIC-INTERPRETER-  C5BD 20BFA3 :1920 -          JSR $A3BF      ; ROUTINE:BLOCKVERSCHIEBEN  C5C0 A553   :1930 -L6        LDA FLAG       ; ENDEFLAG GESETZT?  C5C2 D003   :1950 -          BNE ENDE  C5C4 4C2CC5 :1960 -          JMP BEGIN1     ; NAECHSTEN BEREICH BE-  C5C7 68     :1970 -ENDE      PLA            ; ARBEITEN  C5C8 8501   :1980 -          STA 1          ; AUF BETRIEBSSYS.-ROM  C5CA 58     :1990 -          CLI            ; SCHALTEN  C5CB ADDCC6 :1991 -          LDA SPTR       ; PTR-REG. IN ZERO-PAGE  C5CE AEDDC6 :1992 -          LDX SPTR+1     ; WIEDERHERSTELLEN  C5D1 8550   :1993 -          STA PTR  C5D3 8651   :1994 -          STX PTR+1  C5D5 A003   :1995 -          LDY #3  C5D7 B9DEC6 :1996 -L11       LDA SPTR+2,Y   ; ZERO-PAGE-REG. ZU-  C5DA 99FB00 :1997 -          STA $FB,Y      ; RUECKSETZEN  C5DD 88     :1998 -          DEY   C5DE 10F7   :1999 -          BPL L11  C5E0 60     :2000 -          RTS            ; GC-ROUTINE ENDE  ;  ;  C5E1 906C   :5000 -GETSA     BCC G1         ; C=0 => NAECHSTE STRADR  C5E3 A900   :5010 -          LDA #0         ; HOLEN(ZUM NORMALEN  C5E5 8523   :5020 -          STA STRDP+1    ; EINSPRUNG)  C5E7 A216   :5030 -          LDX #$16       ; C=1:STATUS U. STR.-  C5E9 8622   :5040 -          STX STRDP      ; DESCRIPTORPOINTER INIT  C5EB A903   :5050 -          LDA #3         ;  C5ED 854F   :5065 -          STA STAT       ; STATUS=3:DESCR.-STACK  C5EF A522   :5110 -DSTCK     LDA STRDP      ; STRINGDESCRIPTOR VOM  C5F1 18     :5120 -          CLC            ; STRING DESCRIPTOR-  C5F2 6903   :5130 -          ADC #3         ; STACK HOLEN  C5F4 8522   :5140 -          STA STRDP  C5F6 A000   :5150 -          LDY #0  C5F8 B122   :5160 -          LDA (STRDP),Y  C5FA 854E   :5170 -          STA LEN  C5FC C8     :5180 -          INY   C5FD B122   :5190 -          LDA (STRDP),Y  C5FF AA     :5200 -          TAX   C600 C8     :5210 -          INY   C601 B122   :5220 -          LDA (STRDP),Y  C603 A8     :5230 -          TAY   C604 A516   :5240 -          LDA $16  C606 C522   :5250 -          CMP STRDP  C608 F005   :5260 -          BEQ N1         ; STRINGDESCRIPORSTACK  C60A A54E   :5262 -          LDA LEN        ; LEER? => VARIABLEN  C60C F0E1   :5263 -          BEQ DSTCK  C60E 60     :5270 -          RTS   C60F A52D   :5280 -N1        LDA $2D        ; VAR-ANFANG  C611 A62E   :5290 -          LDX $2E  C613 8522   :5300 -          STA STRDP  C615 8623   :5310 -          STX STRDP+1  C617 A522   :5320 -          LDA STRDP  C619 A002   :5330 -          LDY #2         ; STATUS=2 => VARIABLE  C61B 844F   :5340 -          STY STAT  C61D D00B   :5351 -          BNE V1  C61F 18     :5352 -VAR       CLC   C620 A522   :5353 -          LDA STRDP  C622 6907   :5354 -          ADC #7         ; VARIABLEN-LAENGE  C624 8522   :5355 -          STA STRDP  C626 9002   :5356 -          BCC V1  C628 E623   :5357 -          INC STRDP+1  C62A A623   :5360 -V1        LDX STRDP+1  C62C E430   :5370 -          CPX $30  C62E D004   :5380 -          BNE G2         ; VAR-ENDE ERREICHT  C630 C52F   :5390 -          CMP $2F        ; VAR. ENDE ? JA, ARRAYS  C632 F026   :5400 -          BEQ N2         ; ABSUCHEN  C634 A000   :5410 -G2        LDY #0  C636 B122   :5420 -          LDA (STRDP),Y  ; VAR-NAME UNTERSUCHEN  C638 30E5   :5430 -          BMI VAR        ; KEINE STRINGVAR  C63A C8     :5440 -          INY   C63B B122   :5450 -          LDA (STRDP),Y  C63D 10E0   :5460 -          BPL VAR        ; KEINE STRINGVARIABLE  C63F C8     :5470 -          INY   C640 B122   :5480 -          LDA (STRDP),Y  ; STRINGLAENGE = 0 ?  C642 F0DB   :5485 -          BEQ VAR        ; NAECHSTE VARIABLE  C644 854E   :5490 -          STA LEN  C646 C8     :5500 -          INY   C647 B122   :5510 -          LDA (STRDP),Y  ; STRINGADR. HOLEN  C649 AA     :5520 -          TAX   C64A C8     :5530 -          INY   C64B B122   :5540 -          LDA (STRDP),Y  C64D A8     :5550 -          TAY   C64E 60     :5560 -          RTS   C64F A54F   :5561 -G1        LDA STAT       ; STATUS PRUEFEN  C651 C902   :5562 -          CMP #2         ; UND ZUR STRING-TYP  C653 904A   :5563 -          BCC ARRAY      ; VERZWEIGEN  C655 F0C8   :5564 -          BEQ VAR  C657 4CEFC5 :5565 -          JMP DSTCK  C65A 8550   :5570 -N2        STA PTR        ; POINTER AUF ARRAY INIT  C65C 8651   :5580 -          STX PTR+1  C65E A001   :5590 -          LDY #1         ; STATUS=1: ARRAY  C660 844F   :5600 -          STY STAT  C662 A550   :5660 -NEXTARR   LDA PTR        ; ARRAY-ENDE ERREICHT ?  C664 A651   :5670 -          LDX PTR+1  C666 E432   :5680 -          CPX $32  C668 D004   :5690 -          BNE A1  C66A C531   :5700 -          CMP $31  C66C F057   :5710 -          BEQ N3  C66E 8522   :5720 -A1        STA STRDP  C670 8623   :5730 -          STX STRDP+1  C672 A000   :5740 -          LDY #0  C674 B122   :5750 -          LDA (STRDP),Y  ; ARRAY-NAME  C676 AA     :5760 -          TAX   C677 C8     :5770 -          INY   C678 B122   :5780 -          LDA (STRDP),Y  C67A 08     :5790 -          PHP   C67B C8     :5800 -          INY   C67C B122   :5810 -          LDA (STRDP),Y  ; PTR AUF NAECHSTES  C67E 6550   :5820 -          ADC PTR        ; ARRAY LINKEN  C680 8550   :5830 -          STA PTR  C682 C8     :5840 -          INY   C683 B122   :5850 -          LDA (STRDP),Y  C685 6551   :5860 -          ADC PTR+1  C687 8551   :5870 -          STA PTR+1  C689 28     :5880 -          PLP            ; ARRAY-TYP TESTEN  C68A 10D6   :5890 -          BPL NEXTARR    ; KEIN STRINGARRAY  C68C 8A     :5900 -          TXA   C68D 30D3   :5910 -          BMI NEXTARR  C68F C8     :5920 -          INY   C690 B122   :5930 -          LDA (STRDP),Y  ; ANZAHL DER DIMENSIONEN  C692 A000   :5940 -          LDY #0  C694 0A     :5950 -          ASL            ; DIMENSIONENWERTE  C695 6902   :5960 -          ADC #2         ; UEBERLESEN  C697 6522   :5970 -          ADC STRDP  C699 8522   :5980 -          STA STRDP  C69B 9002   :5990 -          BCC ARRAY  C69D E623   :6000 -          INC STRDP+1  C69F 18     :6001 -ARRAY     CLC   C6A0 A522   :6002 -          LDA STRDP  C6A2 6903   :6003 -          ADC #3         ; STRINGDESCRIPTORLAENGE  C6A4 8522   :6004 -          STA STRDP  C6A6 9002   :6005 -          BCC A5  C6A8 E623   :6006 -          INC STRDP+1  C6AA A623   :6010 -A5        LDX STRDP+1  C6AC E451   :6020 -          CPX PTR+1      ; ARRAY FERTIG DURCH-  C6AE D004   :6030 -          BNE A6         ; SUCHT?  C6B0 C550   :6040 -          CMP PTR  C6B2 F0AE   :6050 -          BEQ NEXTARR  C6B4 A000   :6060 -A6        LDY #0  C6B6 B122   :6070 -          LDA (STRDP),Y  C6B8 F0E5   :6075 -          BEQ ARRAY      ; LAENGE=0 => NACHSTES  C6BA 854E   :6080 -          STA LEN        ; ARRAYELEMENT  C6BC C8     :6090 -          INY   C6BD B122   :6100 -          LDA (STRDP),Y  ; STRINGADRESSE UEBER-  C6BF AA     :6110 -          TAX            ; GEBEN  C6C0 C8     :6120 -          INY   C6C1 B122   :6130 -          LDA (STRDP),Y  C6C3 A8     :6140 -          TAY   C6C4 60     :6200 -          RTS   C6C5 A900   :6210 -N3        LDA #0         ; KEINEN STRING MEHR  C6C7 854E   :6220 -          STA LEN        ; GEFUNDEN  C6C9 60     :6230 -          RTS   ;  ;  C6CA A54F   :8000 -CORR      LDA STAT       ; STRINGADR. KORRIGIEREN  C6CC 0A     :8010 -          ASL            ; C=0,MAL 2  C6CD 69FF   :8020 -          ADC #$FF       ; MINUS 1  C6CF 2903   :8030 -          AND #3         ; NUR 2 BITS ALS INDEX  C6D1 A8     :8040 -          TAY            ; (POSITIONSBERECHNUNG,  C6D2 A558   :8050 -          LDA STRADR     ; DA LAGE D. STRINGADR.  C6D4 9122   :8060 -          STA (STRDP),Y  ; BEI DSTACK, VAR U.  C6D6 C8     :8070 -          INY            ; ARRAY VERSCHIEDEN  C6D7 A559   :8080 -          LDA STRADR+1   ; IST)  C6D9 9122   :8090 -          STA (STRDP),Y  C6DB 60     :8100 -          RTS                8500 -SPTR      .BY 0,0,0,0,0  ; 5-BYTES ZERO-PAGE